import tools/flowc/backends/common;
import tools/flowc/incremental/fiprogram;

// cmd : flowc wise=tools/flowc/backends/wise/tests/test1.wise /tools/flowc/backends/wise/tests/test_1.flow

export {
	fi2wise(program : FiProgram, cfg : FiWiseConfig, callback : (int) -> void) -> void;
}

fi2wise(program : FiProgram, cfg : FiWiseConfig, callback : (int) -> void) -> void {
	traverseInOrder(program.modules, \name, module -> {
		writeWise2file(program, cfg.outputfile, module);
	});
	callback(0);
}

writeWise2file(program : FiProgram, filepath : string, module : FiModule) -> void {
    file = "TODO :: "+toString(program);
    println("TODO: flow->wise");
    ensureDirectoryExists(dirName(filepath));
	if (!setFileContent(filepath, file)) {
		println("Could not write " + filepath);
	}
}