include wase/lib/malloc;
include wase/lib/runtime;

export memory 256;

malloc_test() -> i32 {
	x0 = malloc_alloc(15);
	// malloc_free(x0);
/*	x1 = malloc_alloc(15);
	malloc_free(x1);
	x2 = malloc_alloc(4);
	x3 = malloc_alloc(256);
	alloc_correct = x0 == 16 & x1 == 16 & x2 == 16 & x3 == 43 & malloc_read_head() == 299;
	malloc_free(x3);
	x4 = malloc_alloc(1048576);
	alloc_correct & x4 == -1 & malloc_read_head() == 31;
	*/
	1
}

export _start() -> () {
	malloc_init_allocator(32);
	printi32(malloc_test());
}
