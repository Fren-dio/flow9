import formats/wasm/wasm_encode;

import sys/system;

main() {
	module = WasmModule(
		[], [
			WasmTypeSection([WasmFuncType([], [WasmI32Type()])])
		], // types
		[], [], // imports
		[], [
			WasmFunctionSection([0]) // Reference to type 0
		], // functions
		[], [], // tables
		[], [], // memories
		[], [], // globals
		[], [], // exports
		[], [], // starts
		[], [], // elements
		[], [], // datacounts
		[], [
			WasmCodeSection([
				WasmCode([
						WasmLocal(0, WasmI32Type())
					], 	
					WasmExpr([WasmI32Const(0)])
				)
			])
		], // codes
		[], [], // data
		[]
	);

	bytes = wasmModule2bytes(module);
	
	setFileContentBytes("test.wasm", 
		fold(bytes, "", \acc, byte -> {
			acc + fromCharCode(byte)
		})
	);

	startProcess("wasm2wat", ["test.wasm", "-o", "test.wat"], ".", "", \ec, so, se -> {
		println(ec);
		println(so);
		println(se);
		quit(0);
	});
}
