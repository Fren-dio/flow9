import fabric/env;
import fabric/wrappers;
import fabric/frp_typed;
import fabric/fabric2material;
import material/material2tropic;

export {
	brender(f : Fabric) -> () -> void;
}

brender(f : Fabric) -> () -> void {
	env = makeFabricEnv();
	if (js && !isUrlParameterTrue("force_material")) {
		setRendererType("html");
		enableResize();
		stage = currentClip();
		clip = makeClip();
		setClipStyle(clip, "position", "relative");
		setClipStyle(clip, "width", "100vw");
		setClipStyle(clip, "height", "100vh");
		// Call listenScrollRect to prevent global events from blocking the scroll
		listenScrollRect(clip, nop2);
		addChild(stage, clip);
		div = getClipNativeWidget(clip);
		fabric2dom(makeMaterialManager([]), clip, div, env, f);
	} else {
		fallback = fabric2material(env, f);
		mrender(makeMaterialManager([]), true, fallback);
	}
}