import schedule/scheduler;
import math/md5;

JobContext(
	filename : string,
	job : string
);

JobOutput(
	output : string
);

makeCompileJob(scheduler : Scheduler<JobContext, JobOutput>, file : string) -> Job<JobContext, JobOutput> {
	Job(
		getJobId(scheduler),
		1, 0,
		[],
		JobContext(file, "Compile"),
		md5(getFileContent(file)),
		true,
		ref None(),
		\task : Task<JobContext, JobOutput> -> {
			Promise(
				\onDone : (JobOutput) -> void, onError : (string) -> void -> {
					onError("TODO: Implement compile of " + file)
				}
			)
		}
	);
}

main() {
	scheduler = makeScheduler();

	dispose = runScheduler(scheduler);

	job1 = makeCompileJob(scheduler, "file.flow");

	addJob(scheduler, job1);

	timer(1000, \ -> {
		dispose();
		quit(0);
	})
}
